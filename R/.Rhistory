library(phyloseq); packageVersion("phyloseq")
library(ggplot2); packageVersion("ggplot2")
library(readr)
library(readxl)
library(readr)
phylo_tree <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/phylo_tree.rds")
otu_table_seq <-seqtab.nochim.humans <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/seqtab.nochim.ratshiperammon.Rds")
View(otu_table_seq)
asvmat <- t(otu_table_seq) #Removing sequence rownames for display only
asv.names <- as.data.frame(rownames(asvmat))
rownames(asv.names) <- paste0("ASV", 1:nrow(asv.names))
rownames(asvmat)<-NULL
asvmat <- as.data.frame(asvmat)
rownames(asvmat) <- paste0("ASV", 1:nrow(asvmat))
#colnames(asvmat) <- paste0("Sample", 1:ncol(asvmat)) #keep original sample ID
head(asvmat)
tax_table_names <- read_delim("Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/Tables/tax_table_names.csv",
delim = ";", escape_double = FALSE, trim_ws = TRUE)
tax_table_names <- read_delim("Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/Tables/tax_table_names.csv",
delim = ";", escape_double = FALSE, trim_ws = TRUE)
tax_table_names <- read_delim("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/Tables/tax_table_names.csv",
delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(tax_table_names)
rownames(otu_table_seq)
View(tax_table_names)
metadata_hiper <- read_excel("Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperammon.xlsx")
metadata_hiper <- read_excel("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperammon.xlsx")
View(metadata_hiper)
otu_ok <- as.data.frame(asvmat)
View(tax_table_names)
tax_table_names <- as.data.frame(tax_table_names[-c(1978), ])
rownames(tax_table_names) <- tax_table_names$...1
tax_table<-tax_table_names
tax_table$Species<- ifelse(is.na(tax_table$Species...8) == TRUE, tax_table$Species...9, ifelse(is.na(tax_table$Species...8) == FALSE, tax_table$Species...8, "NA"))
tax_table_ok <- subset(tax_table, select = -c(Species...8, Species...9, ...1))
View(tax_table_ok)
OTU = otu_table(otu_ok, taxa_are_rows = TRUE)
TAX = tax_table(as.matrix(tax_table_ok))
SAMPLE = sample_data(metadata_h)
OTU = otu_table(otu_ok, taxa_are_rows = TRUE)
TAX = tax_table(as.matrix(tax_table_ok))
SAMPLE = sample_data(metadata_hiper)
TREE = tree<- phylo_tree$tree
rownames(SAMPLE) <-metadata_h$SampleID
OTU = otu_table(otu_ok, taxa_are_rows = TRUE)
TAX = tax_table(as.matrix(tax_table_ok))
SAMPLE = sample_data(metadata_hiper)
TREE = tree<- phylo_tree$tree
rownames(SAMPLE) <-metadata_hiper$SampleID
ps <- phyloseq(OTU, TAX, SAMPLE, TREE)
ps
saveRDS(ps, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.Rds")
saveRDS(otu_ok, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/otu_ok.Rds")
saveRDS(tax_table_ok, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/tax_table_ok.Rds")
#Rarefaction curve
#Imp not to include the neg control
library(vegan)
S <- specnumber(t(otu_ok)) # observed number of species
(raremax <- min(rowSums(t(otu_ok))))
Srare <- rarefy(t(otu_ok), raremax)
plot(S, Srare, xlab = "Observed No. of Species", ylab = "Rarefied No. of Species")
abline(0, 1)
rarecurve(t(otu_ok), step = 20, sample = raremax, col = "black", cex = 0.6)
library(phyloseq)
library(decontam)
library(tidyverse)
library(DT)
library(ggplot2); packageVersion("ggplot2")
ps <-readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.Rds")
df <- as.data.frame(sample_data(ps)) # Put sample_data into a ggplot-friendly data.frame
df$LibrarySize <- sample_sums(ps)
df <- df[order(df$LibrarySize),]
df$Index <- seq(nrow(df))
ggplot(data=df, aes(x=Index, y=LibrarySize, color=Sample_type)) + geom_point()
ps <-readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.Rds")
df <- as.data.frame(sample_data(ps)) # Put sample_data into a ggplot-friendly data.frame
df$LibrarySize <- sample_sums(ps)
df <- df[order(df$LibrarySize),]
df$Index <- seq(nrow(df))
ggplot(data=df, aes(x=Index, y=LibrarySize, color=Group)) + geom_point()
phylo_tree <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/phylo_tree.rds")
otu_table_seq <-seqtab.nochim.humans <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/seqtab.nochim.ratshiperammon.Rds")
View(otu_table_seq)
asvmat <- t(otu_table_seq) #Removing sequence rownames for display only
asv.names <- as.data.frame(rownames(asvmat))
rownames(asv.names) <- paste0("ASV", 1:nrow(asv.names))
rownames(asvmat)<-NULL
asvmat <- as.data.frame(asvmat)
rownames(asvmat) <- paste0("ASV", 1:nrow(asvmat))
#colnames(asvmat) <- paste0("Sample", 1:ncol(asvmat)) #keep original sample ID
head(asvmat)
tax_table_names <- read_delim("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/Tables/tax_table_names.csv",
delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(tax_table_names)
metadata_hiper <- read_excel("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperammon.xlsx")
View(metadata_hiper)
otu_ok <- as.data.frame(asvmat)
tax_table_names <- as.data.frame(tax_table_names[-c(1978), ])
rownames(tax_table_names) <- tax_table_names$...1
tax_table<-tax_table_names
tax_table$Species<- ifelse(is.na(tax_table$Species...8) == TRUE, tax_table$Species...9, ifelse(is.na(tax_table$Species...8) == FALSE, tax_table$Species...8, "NA"))
tax_table_ok <- subset(tax_table, select = -c(Species...8, Species...9, ...1))
OTU = otu_table(otu_ok, taxa_are_rows = TRUE)
TAX = tax_table(as.matrix(tax_table_ok))
SAMPLE = sample_data(metadata_hiper)
TREE = tree<- phylo_tree$tree
rownames(SAMPLE) <-metadata_hiper$SampleID
ps <- phyloseq(OTU, TAX, SAMPLE, TREE)
ps
saveRDS(ps, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.Rds")
saveRDS(otu_ok, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/otu_ok.Rds")
saveRDS(tax_table_ok, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/tax_table_ok.Rds")
ps <-readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.Rds")
df <- as.data.frame(sample_data(ps)) # Put sample_data into a ggplot-friendly data.frame
df$LibrarySize <- sample_sums(ps)
df <- df[order(df$LibrarySize),]
df$Index <- seq(nrow(df))
ggplot(data=df, aes(x=Index, y=LibrarySize, color=Sample_type)) + geom_point()
contamdf.freq <- isContaminant(ps, method="frequency", conc="DNA_quant")
contamdf.freq <- isContaminant(ps, method="frequency", conc="Quant_DNA")
head(contamdf.freq)
View(contamdf.freq)
saveRDS(contamdf.freq, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/contaminant_table_freq.Rds")
table(contamdf.freq$contaminant)
head(which(contamdf.freq$contaminant))
(which(contamdf.freq$contaminant))
sample_data(ps)$is.neg <- sample_data(ps)$Sample_type == "Control"
contamdf.prev <- isContaminant(ps, method="prevalence", neg="is.neg")
table(contamdf.prev$contaminant)
#Let’s try using this more aggressive classification threshold rather than the default.
contamdf.prev05 <- isContaminant(ps, method="prevalence", neg="is.neg", threshold=0.5)
table(contamdf.prev05$contaminant)
View(contamdf.prev05)
contamdf.prev05 <- isContaminant(ps, method="prevalence", neg="is.neg", threshold=0.8)
table(contamdf.prev05$contaminant)
sample_data(ps)$is.neg <- sample_data(ps)$Sample_type == "Control"
contamdf.prev <- isContaminant(ps, method="prevalence", neg="is.neg")
table(contamdf.prev$contaminant)
View(otu_ok)
View(metadata_hiper)
sample_data(ps)
sample_data(ps)$is.neg <- sample_data(ps)$Sample_type == "Pool_control"
contamdf.prev <- isContaminant(ps, method="prevalence", neg="is.neg")
table(contamdf.prev$contaminant)
#Let’s try using this more aggressive classification threshold rather than the default.
contamdf.prev05 <- isContaminant(ps, method="prevalence", neg="is.neg", threshold=0.8)
table(contamdf.prev05$contaminant)
sample_data(ps)$is.neg <- sample_data(ps)$Sample_type == "Pool_control"
contamdf.prev <- isContaminant(ps, method="prevalence", neg="is.neg")
table(contamdf.prev$contaminant)
#Let’s try using this more aggressive classification threshold rather than the default.
contamdf.prev05 <- isContaminant(ps, method="prevalence", neg="is.neg", threshold=0.5)
table(contamdf.prev05$contaminant)
# Make phyloseq object of presence-absence in negative controls and true samples
ps.pa <- transform_sample_counts(ps, function(abund) 1*(abund>0))
ps.pa.neg <- prune_samples(sample_data(ps.pa)$Sample_type == "Pool_control", ps.pa)
ps.pa.pos <- prune_samples(sample_data(ps.pa)$Sample_type == "Sample", ps.pa)
# Make data.frame of prevalence in positive and negative samples
df.pa <- data.frame(pa.pos=taxa_sums(ps.pa.pos), pa.neg=taxa_sums(ps.pa.neg),
contaminant=contamdf.prev05$contaminant)
ggplot(data=df.pa, aes(x=pa.neg, y=pa.pos, color=contaminant)) + geom_point() +
xlab("Prevalence (Negative Controls)") + ylab("Prevalence (True Samples)")
sample_data(ps)$is.neg <- sample_data(ps)$Sample_type == "Pool_control"
contamdf.prev <- isContaminant(ps, method="prevalence", neg="is.neg")
table(contamdf.prev$contaminant)
#Let’s try using this more aggressive classification threshold rather than the default.
contamdf.prev05 <- isContaminant(ps, method="prevalence", neg="is.neg", threshold=0.56)
table(contamdf.prev05$contaminant)
sample_data(ps)$is.neg <- sample_data(ps)$Sample_type == "Pool_control"
contamdf.prev <- isContaminant(ps, method="prevalence", neg="is.neg")
table(contamdf.prev$contaminant)
#Let’s try using this more aggressive classification threshold rather than the default.
contamdf.prev05 <- isContaminant(ps, method="prevalence", neg="is.neg", threshold=0.51)
table(contamdf.prev05$contaminant)
sample_data(ps)$is.neg <- sample_data(ps)$Sample_type == "Pool_control"
contamdf.prev <- isContaminant(ps, method="prevalence", neg="is.neg")
table(contamdf.prev$contaminant)
#Let’s try using this more aggressive classification threshold rather than the default.
contamdf.prev05 <- isContaminant(ps, method="prevalence", neg="is.neg", threshold=0.519)
table(contamdf.prev05$contaminant)
sample_data(ps)$is.neg <- sample_data(ps)$Sample_type == "Pool_control"
contamdf.prev <- isContaminant(ps, method="prevalence", neg="is.neg")
table(contamdf.prev$contaminant)
#Let’s try using this more aggressive classification threshold rather than the default.
contamdf.prev05 <- isContaminant(ps, method="prevalence", neg="is.neg", threshold=0.5)
table(contamdf.prev05$contaminant)
plot_frequency(ps, taxa_names(ps)[c(1,3)], conc="DNA_quant") +
xlab("DNA Concentration measured by Qubit")
plot_frequency(ps, taxa_names(ps)[c(1,3)], conc="Quant_DNA") +
xlab("DNA Concentration measured by Qubit")
plot_frequency(ps, taxa_names(ps)[c(51,105, 851, 914)], conc="Quant_DNA") +
xlab("DNA Concentration measured by Qubit")
set.seed(321)
plot_frequency(ps, taxa_names(ps)[sample(which(contamdf.freq$contaminant))], conc="Quant_DNA") +
xlab("DNA Concentration (PicoGreen fluorescent intensity)")
plot_frequency(ps, taxa_names(ps)[c(51,105, 851, 914, 421, 422)], conc="Quant_DNA") +
xlab("DNA Concentration measured by Qubit")
plot_frequency(ps, taxa_names(ps)[c(51,105, 851, 914, 1421, 1422)], conc="Quant_DNA") +
xlab("DNA Concentration measured by Qubit")
plot_frequency(ps, taxa_names(ps)[c(51,105, 851, 914, 1421, 1422)], conc="Quant_DNA") +
xlab("DNA Concentration measured by Qubit")
View(tax_table(ps)[c(51,105, 851, 914, 1421, 1422)])
#Identificados por prevalencia
set.seed(321)
plot_frequency(ps, taxa_names(ps)[sample(which(contamdf.freq$contaminant))], conc="Quant_DNA") +
xlab("DNA Concentration (PicoGreen fluorescent intensity)")
View(tax_table(ps)[c(219,  405,  519,  747,  755, 1053, 1127, 1465)])
ps.noncontamprev <- prune_taxa(!contamdf.prev05$contaminant, ps)
ps.noncontamprev
saveRDS(ps.noncontamprev, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontamprev.Rds")
ps.noncontamfreq <- prune_taxa(!contamdf.freq$contaminant, ps)
ps.noncontamfreq
saveRDS(ps.noncontamfreq, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontamfreq.Rds")
plot_frequency(ps, taxa_names(ps)[c(51,105, 851, 914, 1421, 1422)], conc="Quant_DNA") +
xlab("DNA Concentration measured by Qubit")
plot_frequency(ps, taxa_names(ps)[sample(which(contamdf.freq$contaminant))], conc="Quant_DNA") +
xlab("DNA Concentration (PicoGreen fluorescent intensity)")
View(tax_table(ps)[c(51,105, 851, 914, 1421, 1422)])
contaminants<-c("ASV914", "ASV1421")
goodTaxa <- setdiff(taxa_names(ps), contaminants)
ps.noncontam <- prune_taxa(goodTaxa, ps)
ps.noncontam <- subset_taxa(ps.noncontam, (Order!="Chloroplast") | is.na(Order))
ps.noncontam
ps
saveRDS(ps.noncontam, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontam.Rds")
library("phyloseq"); packageVersion("phyloseq")
library(readr)
library(data.table)
library("ggplot2"); packageVersion("ggplot2")
ps.noncontam <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontam.Rds")
library(readxl)
metadata_hiper <- read_excel("Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiper.xlsx")
ps.noncontam <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontam.Rds")
library(readxl)
metadata_hiper <- read_excel("Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperammon.xlsx")
metadata_hiper <- read_excel("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperammon.xlsx")
View(metadata_h)
metadata_hiper <- read_excel("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperammon.xlsx")
View(metadata_hiper)
ps_1 <-subset_samples(ps.noncontam, SampleID != "Pool_control_S51")
metadata_hiper<-as.data.frame(metadata_hiper)
rownames(metadata_hiper)<-metadata_hiper$SampleID
sample_data(ps_1) <- metadata_hiper
knitr::opts_chunk$set(echo = TRUE)#Rarefaction curve
#Imp not to include the neg control
library(vegan)
S <- specnumber(as.data.frame(t(otu_table(ps_1)))) # observed number of species
(raremax <- min(rowSums(as.data.frame(t(otu_table(ps_1))))))
Srare <- rarefy(t(as.data.frame(otu_table(ps_1))), raremax)
plot(S, Srare, xlab = "Observed No. of Species", ylab = "Rarefied No. of Species")
abline(0, 1)
rarecurve(as.data.frame(t(otu_table(ps_1))), step = 20, sample = raremax, col = "black", cex = 0.6)
saveRDS(ps_1, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps_1.Rds")
sdt = data.table(as(sample_data(ps_1), "data.frame"),
TotalReads = sample_sums(ps_1), keep.rownames = TRUE)
pSeqDepth = ggplot(sdt, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
pSeqDepth
pSeqDepth + facet_wrap(~Group)
sample_sums(ps_1)
View(sample_sums(ps_1))
ps.noncontam <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontam.Rds")
library(readxl)
metadata_hiperiper <- read_excel("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperiperammon.xlsx")
ps.noncontam <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontam.Rds")
library(readxl)
metadata_hiperiper <- read_excel("Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperiperammon.xlsx")
ps.noncontam <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontam.Rds")
library(readxl)
metadata_hiperiper <- read_excel("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperiperammon.xlsx")
ps.noncontam <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontam.Rds")
library(readxl)
metadata_hiper <- read_excel("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperiperammon.xlsx")
ps.noncontam <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.noncontam.Rds")
library(readxl)
metadata_hiper <- read_excel("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/metadata_hiperammon.xlsx")
View(metadata_hiper)
ps_filtered1 <-subset_samples(ps.noncontam, SampleID != "Pool_control_S51")
metadata_hiper<-as.data.frame(metadata_hiper)
rownames(metadata_hiper)<-metadata_hiper$SampleID
sample_data(ps_filtered1) <- metadata_hiper
knitr::opts_chunk$set(echo = TRUE)#Rarefaction curve
#Imp not to include the neg control
library(vegan)
S <- specnumber(as.data.frame(t(otu_table(ps_filtered1)))) # observed number of species
(raremax <- min(rowSums(as.data.frame(t(otu_table(ps_filtered1))))))
Srare <- rarefy(t(as.data.frame(otu_table(ps_filtered1))), raremax)
plot(S, Srare, xlab = "Observed No. of Species", ylab = "Rarefied No. of Species")
abline(0, 1)
rarecurve(as.data.frame(t(otu_table(ps_filtered1))), step = 20, sample = raremax, col = "black", cex = 0.6)
saveRDS(ps_filtered1, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps_filtered1.Rds")
sdt = data.table(as(sample_data(ps_filtered1), "data.frame"),
TotalReads = sample_sums(ps_filtered1), keep.rownames = TRUE)
pSeqDepth = ggplot(sdt, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
pSeqDepth
pSeqDepth + facet_wrap(~Group)
library(vegan)
S <- specnumber(as.data.frame(t(otu_table(ps_filtered1)))) # observed number of species
(raremax <- min(rowSums(as.data.frame(t(otu_table(ps_filtered1))))))
Srare <- rarefy(t(as.data.frame(otu_table(ps_filtered1))), raremax)
plot(S, Srare, xlab = "Observed No. of Species", ylab = "Rarefied No. of Species")
abline(0, 1)
rarecurve(as.data.frame(t(otu_table(ps_filtered1))), step = 20, sample = raremax, col = "black", cex = 0.6)
ps_filtered1 <- readRDS("~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps_filtered1.Rds")
sdt = data.table(as(sample_data(ps_filtered1), "data.frame"),
TotalReads = sample_sums(ps_filtered1), keep.rownames = TRUE)
pSeqDepth = ggplot(sdt, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
pSeqDepth
pSeqDepth + facet_wrap(~Group)
ggplot(sdt, aes(DNA_quant, TotalReads, color = as.factor(Type))) +
geom_point(size = 5) +
geom_smooth(method = lm) +
ggtitle("Sequencing Depth vs. DNAquant") +
scale_y_log10() +
facet_grid(Group ~ .)
ggplot(sdt, aes(Quant_DNA, TotalReads, color = as.factor(Type))) +
geom_point(size = 5) +
geom_smooth(method = lm) +
ggtitle("Sequencing Depth vs. DNAquant") +
scale_y_log10() +
facet_grid(Group ~ .)
sdt
View(sdt)
ggplot(sdt, aes(Quant_DNA, TotalReads, color = as.factor(Group))) +
geom_point(size = 5) +
geom_smooth(method = lm) +
ggtitle("Sequencing Depth vs. DNAquant") +
scale_y_log10() +
facet_grid(Group ~ .)
ggplot(sdt, aes(Quant_DNA, TotalReads, color = as.factor(Group))) +
geom_point(size = 5) +
geom_smooth(method = lm) +
ggtitle("Sequencing Depth vs. DNAquant") +
scale_y_log10()
plot_tree(ps_filtered1, size = "Abundance",
color = "Type",
justify = "yes please",
ladderize = "left") +
scale_size_continuous(range = c(1, 3))
plot_tree(ps_filtered1, size = "Abundance",
color = "Group",
justify = "yes please",
ladderize = "left") +
scale_size_continuous(range = c(1, 3))
# keep result reproductive
set.seed(321)
ps.rarefied = rarefy_even_depth(ps_filtered1, rngseed=1, replace=F)
ps.rarefied
saveRDS(ps.rarefied, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps.rarefied.Rds")
tdt = data.table(tax_table(ps_filtered1),
TotalCounts = taxa_sums(ps_filtered1),
OTU = taxa_names(ps_filtered1))
ggplot(tdt, aes(TotalCounts)) +
geom_histogram() +
ggtitle("Histogram of Total Counts")
# How many singletons?
tdt[(TotalCounts <= 0), .N]
tdt[(TotalCounts <= 1), .N]
# None. This data has been filtered already.
# How many doubletons?
tdt[(TotalCounts <= 2), .N]
#Filtering Threshold plot
# taxa cumulative sum
taxcumsum = tdt[, .N, by = TotalCounts]
setkey(taxcumsum, TotalCounts)
taxcumsum[, CumSum := cumsum(N)]
# Define the plot
pCumSum = ggplot(taxcumsum, aes(TotalCounts, CumSum)) +
geom_point() +
xlab("Filtering Threshold, Minimum Total Counts") +
ylab("OTUs Filtered") +
ggtitle("OTUs that would be filtered vs. the minimum count threshold")
pCumSum
#Zoom in
pCumSum + xlim(0, 100)
# Remove samples with less than MINREADS from phyloseq object
ps_0 <- prune_taxa(taxa_sums(ps_filtered1) > 0, ps_filtered1)
# merge all taxa that are detected rare
total_samples <- phyloseq::nsamples(ps_0)
ps_0
saveRDS(ps_0, "~/Documents/Lola/Datos_CIPF_2023/Rats_HE_HiperAmmon_model/outputs/ps_0.Rds")
